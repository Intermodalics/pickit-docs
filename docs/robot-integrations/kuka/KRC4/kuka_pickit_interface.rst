.. _kuka-krc4-pickit-interface:

KUKA Pickit interface
=====================

This article documents the interface of the KUKA Pickit integration.
For installation instructions, please refer to the :ref:`kuka-krc4-installation-and-setup` article.

.. _kuka-pickit-communication-functions:

Pickit communication functions
------------------------------

Below you find an overview of the functions defined by Pickit that are responsible for communicating with a Pickit system.
For more details on these functions, refer to :ref:`robot-independent-interface`.

+----------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------+-----------------------------------------------------------------+
| Function                                     | Comment                                                                                                                                                                                                                                                  | Input arguments       | Return type                                                     |
+==============================================+==========================================================================================================================================================================================================================================================+=======================+=================================================================+
| Pickit_is_running()                          | Check if Pickit is set to :ref:`Robot mode <web-interface-top-bar>`.                                                                                                                                                                                     | \-                    | Boolean                                                         |
+----------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------+-----------------------------------------------------------------+
| Pickit_do_calibration()                      | Trigger a detection of the robot-camera calibration plate.                                                                                                                                                                                               | \-                    | \-                                                              |
+----------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------+-----------------------------------------------------------------+
| Pickit_look_for_object()                     | Trigger a Pickit object detection using the currently active setup and product :ref:`Configuration`.                                                                                                                                                     | \-                    | \-                                                              |
+----------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------+-----------------------------------------------------------------+
| Pickit_detect_with_retr (LZ_Retries:IN)      | Repeatedly trigger a Pickit object detection as long as nothing is found and the ROI is not empty, up to a number of attempts.                                                                                                                           | max number of retries | \-                                                              |
+----------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------+-----------------------------------------------------------------+
| Pickit_capture_image()                       | Trigger Pickit to capture a camera image to be used by a following **Pickit_process_image()** function.                                                                                                                                                  | \-                    | \-                                                              |
+----------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------+-----------------------------------------------------------------+
| Pickit_process_image()                       | Trigger an object detection on the camera image that was previously captured via the **Pickit_capture_image()** function (or one of the **Detection** functions).                                                                                        | \-                    | \-                                                              |
+----------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------+-----------------------------------------------------------------+
| Pickit_next_object()                         | Request the next detected object.                                                                                                                                                                                                                        | \-                    | \-                                                              |
+----------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------+-----------------------------------------------------------------+
| Pickit_configure (LZ_Setup:IN,LZ_Product:IN) | Load the specified setup and product :ref:`Configuration`.                                                                                                                                                                                               | setup id, product id  | \-                                                              |
+----------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------+-----------------------------------------------------------------+
| Pickit_save_scene()                          | Save a :ref:`snapshot <Snapshots>` with the latest detection results.                                                                                                                                                                                    | \-                    | \-                                                              |
+----------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------+-----------------------------------------------------------------+
| Pickit_build_bkg_cloud()                     | Build the background cloud used by one of the :ref:`advanced-roi-filters`.                                                                                                                                                                               | \-                    | \-                                                              |
+----------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------+-----------------------------------------------------------------+
| Pickit_has_response()                        | Wait for Pickit reply with detection results. **Pickit_has_response()** should always be the next Pickit function after a **Pickit_look_for_object()**, **Pickit_next_object()**, **Pickit_detect_with_retr(..)** or **Pickit_process_image()** request. | \-                    | Boolean - (Some Pickit variables are updated in the background) |
+----------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------+-----------------------------------------------------------------+
| Pickit_get_results()                         | Combination of **Pickit_has_response()** and **Pickit_gppd()** function. It is advised to use this function when working with Pickit version 2.2 onwards. This function is not compatible with Pickit version < 2.2.                                     | \-                    | Boolean - (All Pickit variables are updated in the background)  |
+----------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------+-----------------------------------------------------------------+
| Pickit_gppd()                                | Request the pick point ID and pick point offset of the last requested object. This function is not compatible with Pickit version < 2.2.                                                                                                                 | \-                    | \- (Some Pickit variables are updated in the background)        |
+----------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------+-----------------------------------------------------------------+

Using the Pickit functions with return value
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Some Pickit functions mentioned above have a return value.
These functions are used in the program in a different way than the other functions.
See :ref:`kuka-krc4-example-picking-program` on how they are typically implemented in a robot program.

Pickit helper functions
-----------------------

The following functions don't communicate with Pickit, using the results of previous commands, but make your robot program more readable.
The return values of these functions get updated after using the Pickit functions **Pickit_has_response()** or **Pickit_get_results()**.
See :ref:`kuka-krc4-example-picking-program` on how they are typically implemented in a robot program.

+----------------------------+--------------------------------------------------------------------------------+
| Function                   | Return value                                                                   |
+============================+================================================================================+
| Pickit_object_found()      | True if Detection results are available.                                       |
+----------------------------+--------------------------------------------------------------------------------+
| Pickit_no_image_captured() | True if no image was captured by Pickit, if so check the camera connection.    |
+----------------------------+--------------------------------------------------------------------------------+
| Pickit_roi_empty()         | True if the ROI is empty.                                                      |
+----------------------------+--------------------------------------------------------------------------------+

Pickit output functions
-----------------------

The following functions are used to get the output values of Pickit.
The output values are updated after using the Pickit function **Pickit_has_response()** or **Pickit_get_results()**.

+----------------------------+-----------------------------------------------------------------------------------------------------------------------------------------+-------------+
| Function                   | Comment                                                                                                                                 | Return type |
+============================+=========================================================================================================================================+=============+
| Pickit_get_pose()          | Pick point expressed relatively to the robot base frame.                                                                                | FRAME       |
+----------------------------+-----------------------------------------------------------------------------------------------------------------------------------------+-------------+
| Pickit_get_offset()        | Pick point offset of the last requested object.                                                                                         | FRAME       |
+----------------------------+-----------------------------------------------------------------------------------------------------------------------------------------+-------------+
| Pickit_object_type()       | - For a :ref:`Teach` detection, ID type of the detected object.                                                                         | INT         |
|                            | - For a :ref:`Flex`/:ref:`Pattern` detection, the object type of the detected object.                                                   |             |
+----------------------------+-----------------------------------------------------------------------------------------------------------------------------------------+-------------+
| Pickit_object_pick_id()    | ID of the pick point that was selected for the given object.                                                                            | INT         |
+----------------------------+-----------------------------------------------------------------------------------------------------------------------------------------+-------------+
| Pickit_object_age()        | Amount of time that has passed between the capturing of the camera data and the moment the object information is sent to the robot (s). | REAL        |
+----------------------------+-----------------------------------------------------------------------------------------------------------------------------------------+-------------+
| Pickit_object_dim_1()      | Length or diameter (mm).                                                                                                                | REAL        |
+----------------------------+-----------------------------------------------------------------------------------------------------------------------------------------+-------------+
| Pickit_object_dim_2()      | Width or diameter (mm).                                                                                                                 | REAL        |
+----------------------------+-----------------------------------------------------------------------------------------------------------------------------------------+-------------+
| Pickit_object_dim_3()      | Height (mm).                                                                                                                            | REAL        |
+----------------------------+-----------------------------------------------------------------------------------------------------------------------------------------+-------------+
| Pickit_object_ref_id()     | ID of the selected pick pointâ€™s reference pick point.                                                                                   | INT         |
+----------------------------+-----------------------------------------------------------------------------------------------------------------------------------------+-------------+
| Pickit_remaining_objects() | Number of remaining objects that can be sent to the robot in the next messages.                                                         | INT         |
+----------------------------+-----------------------------------------------------------------------------------------------------------------------------------------+-------------+

Using pick offset in a robot program
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

When using multiple pick points or flexible pick orientations, it can be useful to :ref:`use the pick offset from a reference/nominal pick point in order to correct a drop-off point <smart-place-examples>`.
The following lines of code show how to correct the fixed point ``Dropit`` in a KUKA robot program:

::

  drop_offset = Pickit_get_offset()
  F_drop_correct = Dropit:drop_offset
  PTP F_drop_correct